<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.0"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Jenkins自动打包Android应用 - 东山花灯路</title><meta description="前言已经用Jenkins做过很多Android自动化打包的配置了，无奈记性不咋地，每配一次就要查一次资料，踩同样的坑，浪费不少时间和精力，更是被一些莫名其妙的问题折磨到抓狂，于是我决定在此把Jenkins的配置流程和遇到的坑整理、记录下来（其实早就想这么做了，但是懒癌晚期），方便以后做一些查阅。"><meta property="og:type" content="blog"><meta property="og:title" content="Jenkins自动打包Android应用"><meta property="og:url" content="https://we1code.cn/2018/04/28/jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/"><meta property="og:site_name" content="东山花灯路"><meta property="og:description" content="前言已经用Jenkins做过很多Android自动化打包的配置了，无奈记性不咋地，每配一次就要查一次资料，踩同样的坑，浪费不少时间和精力，更是被一些莫名其妙的问题折磨到抓狂，于是我决定在此把Jenkins的配置流程和遇到的坑整理、记录下来（其实早就想这么做了，但是懒癌晚期），方便以后做一些查阅。"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://dreamweaver.img.we1code.cn/jenkins-cover.jpg"><meta property="article:published_time" content="2018-04-27T16:00:00.000Z"><meta property="article:modified_time" content="2020-05-03T06:43:01.257Z"><meta property="article:author" content="云逸清风"><meta property="article:tag" content="tools"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://dreamweaver.img.we1code.cn/jenkins-cover.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://we1code.cn/2018/04/28/jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/"},"headline":"东山花灯路","image":["https://dreamweaver.img.we1code.cn/jenkins-cover.jpg"],"datePublished":"2018-04-27T16:00:00.000Z","dateModified":"2020-05-03T06:43:01.257Z","author":{"@type":"Person","name":"云逸清风"},"description":"前言已经用Jenkins做过很多Android自动化打包的配置了，无奈记性不咋地，每配一次就要查一次资料，踩同样的坑，浪费不少时间和精力，更是被一些莫名其妙的问题折磨到抓狂，于是我决定在此把Jenkins的配置流程和遇到的坑整理、记录下来（其实早就想这么做了，但是懒癌晚期），方便以后做一些查阅。"}</script><link rel="canonical" href="https://we1code.cn/2018/04/28/jenkins%E8%87%AA%E5%8A%A8%E5%8C%96%E6%89%93%E5%8C%85/"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-155014591-1" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'UA-155014591-1');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.png" alt="东山花灯路" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/bokidoki"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="thumbnail" src="https://dreamweaver.img.we1code.cn/jenkins-cover.jpg" alt="Jenkins自动打包Android应用"></span></div><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" dateTime="2018-04-27T16:00:00.000Z" title="2018-04-27T16:00:00.000Z">2018-04-28</time><span class="level-item"><a class="link-muted" href="/categories/Jenkins/">Jenkins</a></span><span class="level-item">12 分钟 读完 (大约 1848 个字)</span><span class="level-item" id="busuanzi_container_page_pv"><i class="far fa-eye"></i>&nbsp;&nbsp;<span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Jenkins自动打包Android应用</h1><div class="content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>已经用Jenkins做过很多Android自动化打包的配置了，无奈记性不咋地，每配一次就要查一次资料，踩同样的坑，浪费不少时间和精力，更是被一些莫名其妙的问题折磨到抓狂，于是我决定在此把Jenkins的配置流程和遇到的坑整理、记录下来（其实早就想这么做了，但是懒癌晚期），方便以后做一些查阅。</p>
<a id="more"></a>
<h2 id="基本步骤"><a href="#基本步骤" class="headerlink" title="基本步骤"></a>基本步骤</h2><h3 id="全局工具配置"><a href="#全局工具配置" class="headerlink" title="全局工具配置"></a>全局工具配置</h3><p>在系统管理中做全局工具配置，如下图<br><img src="https://dreamweaver.img.we1code.cn/optional1.png" alt="全局工具配置"><br>配置 JAVA_HOME、GRADLE_HOME 指向JDK的安装目录和Gradle的解压目录，然后配置Jenkins的全局变量，这里我配置了python的路径，GRADLE_USER_HOME，这个变量用作gradle的缓存目录，还配置了ANDROID_HOME指向AndroidSdk的目录。</p>
<h3 id="基础工程配置"><a href="#基础工程配置" class="headerlink" title="基础工程配置"></a>基础工程配置</h3><p>基础工程配置分为配置构建参数、源码管理、配置触发器、配置构建工具、构建后的一些操作</p>
<h3 id="构建任务重命名"><a href="#构建任务重命名" class="headerlink" title="构建任务重命名"></a>构建任务重命名</h3><p><img src="https://dreamweaver.img.we1code.cn/%E4%BB%BB%E5%8A%A1%E9%87%8D%E5%91%BD%E5%90%8D.png" alt="重命名"></p>
<h3 id="配置构建参数"><a href="#配置构建参数" class="headerlink" title="配置构建参数"></a>配置构建参数</h3><p>选择参数化构建过程&gt;选项参数<br><img src="https://dreamweaver.img.we1code.cn/jenkins02.jpg" alt="构建参数"></p>
<h3 id="源码管理"><a href="#源码管理" class="headerlink" title="源码管理"></a>源码管理</h3><p>选择git作为版本控制工具<br><img src="https://dreamweaver.img.we1code.cn/jenkins03.png" alt="源码管理"></p>
<h3 id="配置触发器"><a href="#配置触发器" class="headerlink" title="配置触发器"></a>配置触发器</h3><p>解释下触发器的各个选项</p>
<blockquote>
<p>触发远程构建 (例如,使用脚本)<br>GitHub hook trigger for GITScm polling<br>其他工程构建后触发<br>定时构建<br>Help for feature: 定时构建  </p>
</blockquote>
<h4 id="轮询-SCM"><a href="#轮询-SCM" class="headerlink" title="轮询 SCM"></a>轮询 SCM</h4><p>格式为 <em> </em> <em> </em> *<br>第一个星号表示分钟，取值0~59<br>第二个星号表示小时，取值0~23<br>第三个星号表示一个月内的天数，取值1~31<br>第四个星号表示第几个月，取值1~12<br>第五个星号表示一周的第几天，取值0~7</p>
<h3 id="多渠道打包配置"><a href="#多渠道打包配置" class="headerlink" title="多渠道打包配置"></a>多渠道打包配置</h3><h4 id="配置参数"><a href="#配置参数" class="headerlink" title="配置参数"></a>配置参数</h4><p><img src="https://dreamweaver.img.we1code.cn/Jenkins%E6%89%93%E5%8C%85%E6%B8%A0%E9%81%93%E5%8F%B7%E9%85%8D%E7%BD%AE.jpg" alt="添加渠道选项参数"></p>
<h4 id="接入友盟"><a href="#接入友盟" class="headerlink" title="接入友盟"></a>接入<a href="https://developer.umeng.com/docs/66632/detail/101848">友盟</a></h4><pre class=" language-groove"><code class="language-groove">//build.gradle 配置
    productFlavors {
        yingyongbao {
        }
        huawei {
        }
    }

    productFlavors.all { flavor ->
        flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]
    }
</code></pre>
<h3 id="加固"><a href="#加固" class="headerlink" title="加固"></a>加固</h3><p>我在项目使用的是乐固加固，首先去下载他们的<a href="https://leguimg.qcloud.com/ms-client/java-tool/1.0.3/ms-shield.jar">jar包</a>。进入项目配置文件开始配置：  </p>
<p>配置构建后操作，执行打包后再执行加固，如下图：<br><img src="https://dreamweaver.img.we1code.cn/%E5%8A%A0%E5%9B%BA%E6%AD%A5%E9%AA%A41.jpg" alt="加固步骤1"></p>
<p>接下来转到加固项目的配置中，可以将下载下来的jar包做版本管理，也可以直接放在项目根目录中，配置构建步骤：<br><img src="https://dreamweaver.img.we1code.cn/%E5%8A%A0%E5%9B%BA%E6%AD%A5%E9%AA%A42.jpg" alt="加固步骤2"></p>
<h3 id="再签名"><a href="#再签名" class="headerlink" title="再签名"></a>再签名</h3><p>然鹅加固完之后并没有结束，需要进行再签名，</p>
<blockquote>
<p><a href="https://cloud.tencent.com/document/product/283/3271">加固过程不可避免的会破坏签名，因此加固后的包需重签名，未签名应用将无法顺利安装。</a></p>
</blockquote>
<p>这里我是又另外建了一个项目，应该还有比较好的做法比如构建后执行什么的(需要另装插件)  </p>
<p>主要看看签名脚本是怎么写的</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">import</span> sys<span class="token punctuation">,</span> os
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'使用apksiger命令为apk签名'</span><span class="token punctuation">)</span>
files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span>
jks_file <span class="token operator">=</span> None
apk_file <span class="token operator">=</span> None
<span class="token keyword">for</span> file <span class="token keyword">in</span> files<span class="token punctuation">:</span>
    <span class="token keyword">if</span> file<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.jks'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        jks_file <span class="token operator">=</span> file
    <span class="token keyword">elif</span> file<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'.apk'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        apk_file <span class="token operator">=</span> file
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>
<span class="token keyword">if</span> jks_file <span class="token operator">==</span> None <span class="token operator">or</span> apk_file <span class="token operator">==</span> None<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'当前目录不存在签名文件或者apk文件，请确认签名文件在当前目录下'</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
file_name<span class="token operator">=</span>apk_file
zipalign_name<span class="token operator">=</span>file_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.apk'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'_zipalign.apk'</span>
command<span class="token operator">=</span><span class="token string">'zipalign -v -p 4 {0} {1}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> zipalign_name<span class="token punctuation">)</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
jks_name<span class="token operator">=</span>jks_file
key_alias <span class="token operator">=</span> <span class="token string">'bonadeTravel'</span>
ks_pass <span class="token operator">=</span> <span class="token string">'bonadetravel888'</span>
key_pass <span class="token operator">=</span> <span class="token string">'bonadetravel888'</span>
apk_name<span class="token operator">=</span>zipalign_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.apk'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token string">'_signed.apk'</span>
command<span class="token operator">=</span><span class="token string">'apksigner sign --ks {0} --ks-key-alias {1} --ks-pass pass:{2} --key-pass pass:{3} --out {4} {5}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>jks_name<span class="token punctuation">,</span> key_alias<span class="token punctuation">,</span> ks_pass<span class="token punctuation">,</span> key_pass<span class="token punctuation">,</span> apk_name<span class="token punctuation">,</span> zipalign_name<span class="token punctuation">)</span>
os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
</code></pre>
<h3 id="执行构建脚本"><a href="#执行构建脚本" class="headerlink" title="执行构建脚本"></a>执行构建脚本</h3><pre class=" language-groovy"><code class="language-groovy">clean
assemble<span class="token punctuation">$</span><span class="token punctuation">{</span>channel<span class="token punctuation">}</span><span class="token punctuation">$</span><span class="token punctuation">{</span>buildType<span class="token punctuation">}</span> <span class="token operator">--</span>stacktrace
<span class="token comment" spellcheck="true">//如果需要打所有渠道包</span>
assemble<span class="token punctuation">$</span><span class="token punctuation">{</span>buildType<span class="token punctuation">}</span> <span class="token operator">--</span>stacktrace
</code></pre>
<h3 id="构建后的操作"><a href="#构建后的操作" class="headerlink" title="构建后的操作"></a>构建后的操作</h3><p>构建完成后的操作:  </p>
<ol>
<li>提取apk文件</li>
<li>上传到蒲公英</li>
<li>jenkins中生成二维码</li>
<li>通知测试人员</li>
</ol>
<h2 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h2><p>想修改一下apk文件输出目录，于是修改build.gradle  </p>
<pre class=" language-groovy"><code class="language-groovy">applicationVariants<span class="token operator">.</span>all <span class="token punctuation">{</span> variant <span class="token operator">-></span>
    variant<span class="token operator">.</span>outputs<span class="token operator">.</span>each <span class="token punctuation">{</span> output <span class="token operator">-></span>
        <span class="token keyword">def</span> outputFile <span class="token operator">=</span> output<span class="token operator">.</span>outputFile
        <span class="token keyword">if</span> <span class="token punctuation">(</span>outputFile <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> outputFile<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token string">'.apk'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>outputFile<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"debug"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">def</span> fileName <span class="token operator">=</span> outputFile<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">".apk"</span><span class="token punctuation">,</span> <span class="token string">"-${defaultConfig.versionName}.apk"</span><span class="token punctuation">)</span>
                output<span class="token operator">.</span>outputFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\user\\Desktop\\apk\\${defaultConfig.versionName}"</span><span class="token punctuation">,</span> fileName<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>在4.0+gradle方法稍有不同</p>
<pre class=" language-groovy"><code class="language-groovy">applicationVariants<span class="token operator">.</span>all <span class="token punctuation">{</span> variant <span class="token operator">-></span>
    variant<span class="token operator">.</span>outputs<span class="token operator">.</span>all <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 自定义输出路径 但是getPackageApplication()将在19年底被移除</span>
        variant<span class="token operator">.</span><span class="token function">getPackageApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>outputDirectory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>project<span class="token operator">.</span>rootDir<span class="token operator">.</span>absolutePath <span class="token operator">+</span> File<span class="token operator">.</span>separator <span class="token operator">+</span> <span class="token string">"outputs"</span><span class="token punctuation">)</span>
        outputFileName <span class="token operator">=</span> <span class="token string">"AppName-${variant.flavorName}-${variant.buildType.name}-v${variant.versionName}_${time()}.apk"</span>
    <span class="token punctuation">}</span>
</code></pre>
<p>最终版本</p>
<pre class=" language-groovy"><code class="language-groovy">applicationVariants<span class="token operator">.</span>all <span class="token punctuation">{</span> variant <span class="token operator">-></span>
    variant<span class="token operator">.</span>outputs<span class="token operator">.</span>all <span class="token punctuation">{</span>
        <span class="token keyword">def</span> newName
        <span class="token keyword">def</span> timeNow
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"true"</span><span class="token operator">.</span><span class="token function">equals</span><span class="token punctuation">(</span>IS_JENKINS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            timeNow <span class="token operator">=</span> JENKINS_TIME
            variant<span class="token operator">.</span>packageApplicationProvider<span class="token operator">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span>outputDirectory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>project<span class="token operator">.</span>rootDir<span class="token operator">.</span>absolutePath <span class="token operator">+</span> File<span class="token operator">.</span>separator <span class="token operator">+</span> <span class="token string">"apks"</span><span class="token punctuation">)</span>
            newName <span class="token operator">=</span> <span class="token string">"xxx-v${APP_VERSION}-${timeNow}-${variant.buildType.name}.apk"</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            timeNow <span class="token operator">=</span> <span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>variant<span class="token operator">.</span>buildType<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">'debug'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                newName <span class="token operator">=</span> <span class="token string">"xxx-v${APP_VERSION}-debug.apk"</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                newName <span class="token operator">=</span> <span class="token string">"xxx-v${APP_VERSION}-${timeNow}-${variant.buildType.name}.apk"</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        outputFileName <span class="token operator">=</span> <span class="token string">"${newName}"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="遇到的坑"><a href="#遇到的坑" class="headerlink" title="遇到的坑"></a>遇到的坑</h2><h3 id="在jenkins中编译的时候报错找不到abc-ab-share-pack-mtrl-alpha-9-png"><a href="#在jenkins中编译的时候报错找不到abc-ab-share-pack-mtrl-alpha-9-png" class="headerlink" title="在jenkins中编译的时候报错找不到abc_ab_share_pack_mtrl_alpha.9.png"></a>在jenkins中编译的时候报错找不到abc_ab_share_pack_mtrl_alpha.9.png</h3><p><img src="https://dreamweaver.img.we1code.cn/jenkins04.png" alt="error"><br>wtf没见过这种错误啊，我估摸着会不会是路径太长的原因，于是在gradle.properties中配置了android.buildCacheDir=F\://androidCache，但是，并没有卵用，秉承着不解决问题不罢休的态度，我又浪费了一个下午。终于，在stackoverflow上，看到有个哥们提到在jenkins中设置GRADLE_USER_HOME这个环境变量，随便指向一个目录。然后就不报错了。我的内心是崩溃的，好吧，总算是解决了，但是为什么AndroidStudio下编译就不会报错呢。</p>
<h3 id="com-sun-org-apache-xerces-internal-impl-io-MalformedByteSequenceException-3-字节的-UTF-8-序列的字节-3-无效"><a href="#com-sun-org-apache-xerces-internal-impl-io-MalformedByteSequenceException-3-字节的-UTF-8-序列的字节-3-无效" class="headerlink" title="com.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceException: 3 字节的 UTF-8 序列的字节 3 无效"></a>com.sun.org.apache.xerces.internal.impl.io.MalformedByteSequenceException: 3 字节的 UTF-8 序列的字节 3 无效</h3><p>又碰到一个奇怪的问题，这个坑是databinding框架产生的，由于我是在linux上开发的，jenkins环境部署在本地的windows上，在xml中databinding的表达式中如果出现了中文字符，就会报编码错误，于是我只能硬着头皮修改布局文件，把中文字符移到资源文件中。</p>
<h3 id="开启混淆后报错，proguard-rules-pro文件配置出错"><a href="#开启混淆后报错，proguard-rules-pro文件配置出错" class="headerlink" title="开启混淆后报错，proguard-rules.pro文件配置出错"></a>开启混淆后报错，proguard-rules.pro文件配置出错</h3><pre class=" language-batch"><code class="language-batch"><span class="token command"><span class="token keyword">Execution</span> failed for task ':app:transformClassesAndResourcesWithProguardForRelease'.</span>
</code></pre>
<p>通过执行</p>
<pre class=" language-batch"><code class="language-batch"><span class="token command"><span class="token keyword">gradlew</span> <span class="token parameter attr-name">--stacktrace</span> task xxx</span>
</code></pre>
<p>可以看到具体的报错信息，主要是不能混淆的文件没有忽略掉，逐个干掉就行了。</p>
<h3 id="jenkins使用不了系统的环境变量"><a href="#jenkins使用不了系统的环境变量" class="headerlink" title="jenkins使用不了系统的环境变量"></a>jenkins使用不了系统的环境变量</h3><p>配置一下jenkins的环境变量然后重启生效</p>
<p><img src="https://dreamweaver.img.we1code.cn/%E9%85%8D%E7%BD%AEJenkins%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F.png" alt="环境变量配置"></p>
<h3 id="jenkins控制台出现中文乱码"><a href="#jenkins控制台出现中文乱码" class="headerlink" title="jenkins控制台出现中文乱码"></a>jenkins控制台出现中文乱码</h3><p>jenkins环境变量中添加 key: LANG value: zh.CH.UTF-8</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="http://www.aoaoyi.com/archives/1126.html">用apksigner进行批量签名的脚本</a><br><a href="https://cloud.tencent.com/developer/article/1135340">乐固加固FAQ</a></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>上面记录的问题只不过是诸多问题的冰山一角，以后我遇到的jenkins相关的问题都会记录于此。想要熟练运用Android打包，看样子还是要深入研究一下gradle才行呐。</p>
</div><div class="article-tags size-small is-uppercase mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/tools/">tools</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=5eae347b7d4ec20012dc0389&amp;product=inline-share-buttons&amp;cms=sop" defer></script></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/05/29/Android%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Android代码混淆</span></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1.6.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: 'a0421d06e53eba732b9f4b99ebbe09ad',
            repo: 'blog-comment',
            owner: 'bokidoki',
            clientID: '3beba67bd514e2528f91',
            clientSecret: '4d1a02948bd809436979d93685fcc36199776994',
            admin: "bokidoki",
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 20,
            pagerDirection: 'last',
            
            
            enableHotKey: true
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="is-rounded" src="/img/avatar.jpg" alt="云逸清风"></figure><p class="title is-size-4 is-block line-height-inherit">云逸清风</p><p class="is-size-6 is-block">Android Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>广州,中国</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">17</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">5</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">7</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/bokidoki" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/bokidoki"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile is-mobile" href="https://hexo.io" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Hexo</span></span><span class="level-right"><span class="level-item tag">hexo.io</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Jenkins/"><span class="level-start"><span class="level-item">Jenkins</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Kotlin/"><span class="level-start"><span class="level-item">Kotlin</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/ssr/"><span class="level-start"><span class="level-item">ssr</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button is-primary" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content size-small"><p><time dateTime="2020-04-01T07:29:07.000Z">2020-04-01</time></p><p class="title is-6"><a class="link-muted" href="/2020/04/01/Android%E5%AD%98%E5%82%A8/">Android存储系统</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2019-12-08T03:40:34.000Z">2019-12-08</time></p><p class="title is-6"><a class="link-muted" href="/2019/12/08/Arouter/">Arouter 原理浅析</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2019-11-07T06:44:46.000Z">2019-11-07</time></p><p class="title is-6"><a class="link-muted" href="/2019/11/07/Jetpack-livedata/">Android Jetpack系列其二livedata</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2019-10-24T03:02:49.000Z">2019-10-24</time></p><p class="title is-6"><a class="link-muted" href="/2019/10/24/KotlinDelegate/">Koltin委托属性</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Kotlin/">Kotlin</a></p></div></article><article class="media"><div class="media-content size-small"><p><time dateTime="2019-09-29T11:02:46.000Z">2019-09-29</time></p><p class="title is-6"><a class="link-muted" href="/2019/09/29/Fragment%E5%8E%9F%E7%90%86%E6%B5%85%E6%9E%90/">Fragment原理浅析</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/Android/">Android</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/archives/2020/04/"><span class="level-start"><span class="level-item">四月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/android/"><span class="tag">android</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/framework/"><span class="tag">framework</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/jetpack/"><span class="tag">jetpack</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/library/"><span class="tag">library</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tools/"><span class="tag">tools</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%85%B6%E4%BB%96/"><span class="tag">其他</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9F%BA%E7%A1%80/"><span class="tag">基础</span><span class="tag is-grey-lightest">10</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.png" alt="东山花灯路" height="28"></a><p class="size-small"><span>&copy; 2020 云逸清风</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            site: {
                url: 'https://we1code.cn',
                external_link: {"enable":true,"exclude":[]}
            },
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>